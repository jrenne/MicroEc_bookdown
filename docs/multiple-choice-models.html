<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 Multiple Choice Models | Micro-Econometrics</title>
<meta name="author" content="Jean-Paul Renne">
<meta name="description" content="We will now consider cases where the number of possible outcomes (or alternatives) is larger than two. Let us denote by \(J\) this number. We have \(y_j \in \{1,\dots,J\}\). This situation arise...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 5 Multiple Choice Models | Micro-Econometrics">
<meta property="og:type" content="book">
<meta property="og:description" content="We will now consider cases where the number of possible outcomes (or alternatives) is larger than two. Let us denote by \(J\) this number. We have \(y_j \in \{1,\dots,J\}\). This situation arise...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 5 Multiple Choice Models | Micro-Econometrics">
<meta name="twitter:description" content="We will now consider cases where the number of possible outcomes (or alternatives) is larger than two. Let us denote by \(J\) this number. We have \(y_j \in \{1,\dots,J\}\). This situation arise...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="my-style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Micro-Econometrics</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Micro-Econometrics</a></li>
<li><a class="" href="ChapterLS.html"><span class="header-section-number">1</span> Linear Regressions</a></li>
<li><a class="" href="Panel.html"><span class="header-section-number">2</span> Panel regressions</a></li>
<li><a class="" href="estimation-methods.html"><span class="header-section-number">3</span> Estimation Methods</a></li>
<li><a class="" href="binary-choice-models.html"><span class="header-section-number">4</span> Binary-choice models</a></li>
<li><a class="active" href="multiple-choice-models.html"><span class="header-section-number">5</span> Multiple Choice Models</a></li>
<li><a class="" href="tobit-and-sample-selection-models.html"><span class="header-section-number">6</span> Tobit and sample-selection models</a></li>
<li><a class="" href="models-of-count-data.html"><span class="header-section-number">7</span> Models of Count Data</a></li>
<li><a class="" href="append.html"><span class="header-section-number">8</span> Appendix</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="multiple-choice-models" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Multiple Choice Models<a class="anchor" aria-label="anchor" href="#multiple-choice-models"><i class="fas fa-link"></i></a>
</h1>
<p>We will now consider cases where the number of possible outcomes (or alternatives) is larger than two. Let us denote by <span class="math inline">\(J\)</span> this number. We have <span class="math inline">\(y_j \in \{1,\dots,J\}\)</span>. This situation arise for instance when the outcome variable reflects:</p>
<ul>
<li>Opinions: strongly opposed / opposed / neutral / support (ranked choices),</li>
<li>Occupational field: lawyer / farmer / engineer / doctor / …,</li>
<li>Alternative shopping areas,</li>
<li>Transportation types.</li>
</ul>
<p>In a few cases, the values associated with the choices will themselves be meaningful, for example, number of accidents per day: <span class="math inline">\(y = 0, 1,2, \dots\)</span> (count data). In most cases, the values are meaningless.</p>
<p>We assume the existence of covariates, gathered in vector <span class="math inline">\(\mathbf{x}_i\)</span> (<span class="math inline">\(K \times 1\)</span>), that are suspected to influence for the probabilities of obtaining the different outcomes (<span class="math inline">\(y_i=j\)</span>, <span class="math inline">\(j \in \{1,\dots,J\}\)</span>).</p>
<p>In what follows, we will assume that the <span class="math inline">\(y_i\)</span>’s are assumed to be independently distributed, with:
<span class="math display" id="eq:generalMultiNom">\[\begin{equation}
y_i = \left\{
\begin{array}{cl}
1 &amp; \mbox{ with probability } g_1(\mathbf{x}_i;\boldsymbol\theta)\\
\vdots \\
J &amp; \mbox{ with probability } g_J(\mathbf{x}_i;\boldsymbol\theta).
\end{array}
\right.\tag{5.1}
\end{equation}\]</span></p>
<p>(Of course, for all entities (<span class="math inline">\(i\)</span>), we must have <span class="math inline">\(\sum_{j=1}^J g_j(\mathbf{x}_i;\boldsymbol\theta)=1\)</span>.) Our objective is to estimate the vector of population parameters <span class="math inline">\(\boldsymbol\theta\)</span> given functional forms for the <span class="math inline">\(g_j\)</span>’s.</p>
<div id="ordered-case" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Ordered case<a class="anchor" aria-label="anchor" href="#ordered-case"><i class="fas fa-link"></i></a>
</h2>
<p>Sometimes, there exists a natural order for the different alternatives. This is typically the case where respondents have to choose a level of agreement to a statement, e.g.: (1) Strongly disagree; (2) Disagree; (3) Neither agree nor disagree; (4) Agree; (5) Strongly agree. Another standard case is that of ratings (from A to F, say).</p>
<p>The ordered probit model consists in extending the binary case, considering the latent-variable view of the latter (see Section <a href="binary-choice-models.html#latent">4.1</a>). Formally, the model is as follows:
<span class="math display" id="eq:Pordered">\[\begin{equation}
\mathbb{P}(y_i = j | \mathbf{x}_i) = \mathbb{P}(\alpha_{j-1} &lt;y^*_i &lt; \alpha_{j} |\mathbf{x}_i), \tag{5.2}
\end{equation}\]</span>
where
<span class="math display">\[
y_{i}^* = \boldsymbol\theta'\mathbf{x}_i + \varepsilon_i,
\]</span>
with <span class="math inline">\(\varepsilon_i \sim \,i.i.d.\,\mathcal{N}(0,1)\)</span>. The <span class="math inline">\(\alpha_j\)</span>’s, <span class="math inline">\(j \in \{1,\dots,J-1\}\)</span>, are (new) parameters that have to be estimated, on top of <span class="math inline">\(\boldsymbol\theta\)</span>. Naturally, we have <span class="math inline">\(\alpha_1&lt;\alpha_2&lt;\dots&lt;\alpha_{J-1}\)</span>. Moreover <span class="math inline">\(\alpha_0\)</span> is <span class="math inline">\(- \infty\)</span> and <span class="math inline">\(\alpha_J\)</span> is <span class="math inline">\(+ \infty\)</span>, so that Eq. <a href="multiple-choice-models.html#eq:Pordered">(5.2)</a> is valid for any <span class="math inline">\(j \in \{1,\dots,J\}\)</span> (including <span class="math inline">\(1\)</span> and <span class="math inline">\(J\)</span>).</p>
<p>We have:
<span class="math display">\[\begin{eqnarray*}
g_j(\mathbf{x}_i;\boldsymbol\theta,\boldsymbol\alpha) = \mathbb{P}(y_i = j | \mathbf{x}_i) &amp;=&amp; \mathbb{P}(\alpha_{j-1} &lt;y^*_i &lt; \alpha_{j} |\mathbf{x}_i) \\
&amp;=&amp; \mathbb{P}(\alpha_{j-1} - \boldsymbol\theta'\mathbf{x}_i  &lt;\varepsilon_i &lt; \alpha_{j} - \boldsymbol\theta'\mathbf{x}_i) \\
&amp;=&amp; \Phi(\alpha_{j} - \boldsymbol\theta'\mathbf{x}_i) - \Phi(\alpha_{j-1} - \boldsymbol\theta'\mathbf{x}_i),
\end{eqnarray*}\]</span>
where <span class="math inline">\(\Phi\)</span> is the c.d.f. of <span class="math inline">\(\mathcal{N}(0,1)\)</span>.</p>
<p>If, for all <span class="math inline">\(i\)</span>, one of the components of <span class="math inline">\(\mathbf{x}_i\)</span> is equal to 1 (which is what is done in linear regression to introduce an intercept in the specification), then one of the <span class="math inline">\(\alpha_j\)</span> (<span class="math inline">\(j\in\{1,\dots,J-1\}\)</span>) is not identified. One can then arbitrarily set <span class="math inline">\(\alpha_1=0\)</span>. This is what is done in the binary logit/probit cases.</p>
<p>This model can be estimated by maximizing the likelihood function (see Section <a href="estimation-methods.html#secMLE">3.2</a>). This function is given by:
<span class="math display" id="eq:multipleLogLik">\[\begin{equation}
\log \mathcal{L}(\boldsymbol\theta,\boldsymbol\alpha;\mathbf{y},\mathbf{X}) = \sum_{i=1}^n  \sum_{j=1}^J \mathbb{I}_{\{y_i=j\}} \log \left(g_j(\mathbf{x}_i;\boldsymbol\theta,\boldsymbol\alpha)\right). \tag{5.3}
\end{equation}\]</span></p>
<p>Let us stress that we have two types of parameters to estimate: those included in vector <span class="math inline">\(\boldsymbol\theta\)</span>, and the <span class="math inline">\(\alpha_j\)</span>’s, gathered in vector <span class="math inline">\(\boldsymbol\alpha\)</span>.</p>
<p>The estimated values of the <span class="math inline">\(\theta_j\)</span>’s are slightly more complicated to interpret (at least in term of sign) than in the binary case. Indeed, we have:
<span class="math display">\[
\mathbb{P}(y_i \le j | \mathbf{x}_i) = \Phi(\alpha_{j} - \boldsymbol\theta'\mathbf{x}_i) \Rightarrow \frac{\partial \mathbb{P}(y_i \le j | \mathbf{x}_i)}{\mathbf{x}_i} =- \underbrace{\Phi'(\alpha_{j} - \boldsymbol\theta'\mathbf{x}_i)}_{&gt;0}\boldsymbol\theta.
\]</span>
Hence the sign of <span class="math inline">\(\theta_k\)</span> indicates whether <span class="math inline">\(\mathbb{P}(y_i \le j | \mathbf{x}_i)\)</span> increases or decreases w.r.t. <span class="math inline">\(x_{i,k}\)</span> (the <span class="math inline">\(k^{th}\)</span> component of <span class="math inline">\(\mathbf{x}_i\)</span>). By contrast:
<span class="math display">\[
\frac{\partial \mathbb{P}(y_i = j | \mathbf{x}_i)}{\mathbf{x}_i} = \underbrace{\left(-F'(\alpha_{j} + \boldsymbol\theta'\mathbf{x}_i)+F'(\alpha_{j-1} + \boldsymbol\theta'\mathbf{x}_i)\right)}_{A}\boldsymbol\theta.
\]</span>
Therefore the signs of the components of <span class="math inline">\(\boldsymbol\theta\)</span> are not necessarily those of the marginal effects. (For the sign of <span class="math inline">\(A\)</span> is a priori unknown.)</p>
<div class="example">
<p><span id="exm:orderedCredit" class="example"><strong>Example 5.1  (Predicting credit ratings (Lending-club dataset)) </strong></span>Let us use credit dataset again (see Example <a href="binary-choice-models.html#exm:creditProbit">4.3</a>), and let use try and model the ratings attributed by the lending-club:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">AEC</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span><span class="va">credit</span><span class="op">$</span><span class="va">emp_length_low5y</span>   <span class="op">&lt;-</span> <span class="va">credit</span><span class="op">$</span><span class="va">emp_length</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt; 1 year"</span>,<span class="st">"1 year"</span>,<span class="st">"2 years"</span>,<span class="st">"3 years"</span>,<span class="st">"4 years"</span><span class="op">)</span></span>
<span><span class="va">credit</span><span class="op">$</span><span class="va">emp_length_high10y</span> <span class="op">&lt;-</span> <span class="va">credit</span><span class="op">$</span><span class="va">emp_length</span><span class="op">==</span><span class="st">"10+ years"</span></span>
<span><span class="va">credit</span><span class="op">$</span><span class="va">annual_inc</span> <span class="op">&lt;-</span> <span class="va">credit</span><span class="op">$</span><span class="va">annual_inc</span><span class="op">/</span><span class="fl">1000</span></span>
<span><span class="va">credit</span><span class="op">$</span><span class="va">loan_amnt</span>  <span class="op">&lt;-</span> <span class="va">credit</span><span class="op">$</span><span class="va">loan_amnt</span><span class="op">/</span><span class="fl">1000</span></span>
<span><span class="va">credit</span><span class="op">$</span><span class="va">income2loan</span> <span class="op">&lt;-</span> <span class="va">credit</span><span class="op">$</span><span class="va">annual_inc</span><span class="op">/</span><span class="va">credit</span><span class="op">$</span><span class="va">loan_amnt</span></span>
<span><span class="va">training</span> <span class="op">&lt;-</span> <span class="va">credit</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20000</span>,<span class="op">]</span> <span class="co"># sample is reduced</span></span>
<span><span class="va">training</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">training</span>,<span class="va">grade</span><span class="op">!=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"E"</span>,<span class="st">"F"</span>,<span class="st">"G"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">training</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">training</span><span class="op">)</span></span>
<span><span class="va">training</span><span class="op">$</span><span class="va">grade.ordered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">training</span><span class="op">$</span><span class="va">grade</span>,ordered<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>                                 levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"D"</span>,<span class="st">"C"</span>,<span class="st">"B"</span>,<span class="st">"A"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html">polr</a></span><span class="op">(</span><span class="va">grade.ordered</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">loan_amnt</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">income2loan</span><span class="op">)</span> <span class="op">+</span> <span class="va">delinq_2yrs</span>,</span>
<span>               data<span class="op">=</span><span class="va">training</span>, Hess<span class="op">=</span><span class="cn">TRUE</span>, method<span class="op">=</span><span class="st">"probit"</span><span class="op">)</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html">polr</a></span><span class="op">(</span><span class="va">grade.ordered</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">loan_amnt</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">income2loan</span><span class="op">)</span> <span class="op">+</span> <span class="va">delinq_2yrs</span> <span class="op">+</span></span>
<span>                 <span class="va">emp_length_low5y</span> <span class="op">+</span> <span class="va">emp_length_high10y</span>,</span>
<span>               data<span class="op">=</span><span class="va">training</span>, Hess<span class="op">=</span><span class="cn">TRUE</span>, method<span class="op">=</span><span class="st">"probit"</span><span class="op">)</span></span>
<span><span class="fu">stargazer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html">stargazer</a></span><span class="op">(</span><span class="va">model1</span>,<span class="va">model2</span>,ord.intercepts <span class="op">=</span> <span class="cn">TRUE</span>,type<span class="op">=</span><span class="st">"text"</span>,</span>
<span>                     no.space <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## ===============================================
##                        Dependent variable:     
##                    ----------------------------
##                           grade.ordered        
##                         (1)            (2)     
## -----------------------------------------------
## log(loan_amnt)         -0.014        -0.040*   
##                       (0.022)        (0.022)   
## log(income2loan)      0.115***      0.092***   
##                       (0.022)        (0.022)   
## delinq_2yrs          -0.399***      -0.404***  
##                       (0.025)        (0.025)   
## emp_length_low5y                    -0.096***  
##                                      (0.027)   
## emp_length_high10y                   0.088**   
##                                      (0.035)   
## D| C                 -0.937***      -1.073***  
##                       (0.082)        (0.086)   
## C| B                  -0.160**      -0.295***  
##                       (0.082)        (0.085)   
## B| A                  0.696***      0.564***   
##                       (0.082)        (0.086)   
## -----------------------------------------------
## Observations           8,695          8,695    
## ===============================================
## Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<p>Predicted ratings (and probabilties of being given a given rating) can be computed as follows:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.grade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model1</span>,newdata <span class="op">=</span> <span class="va">training</span><span class="op">)</span></span>
<span><span class="co"># pred.grade = predicted grade, defined as the most likely according model</span></span>
<span><span class="va">pred.proba</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model1</span>,newdata <span class="op">=</span> <span class="va">training</span>, type<span class="op">=</span><span class="st">"probs"</span><span class="op">)</span></span></code></pre></div>
</div>
<!-- \begin{exerc}[Political information] -->
<!-- Using the data available \href{https://vincentarelbundock.github.io/Rdatasets/csv/pscl/politicalInformation.csv}{here} and documented \href{https://vincentarelbundock.github.io/Rdatasets/doc/pscl/politicalInformation.html}{here}, propose a model for the political information level. -->
<!-- \end{exerc} -->
<!-- \vspace{.5cm} -->
<!-- \begin{exerc}[Wine quality] -->
<!-- Using the data available \href{https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-white.csv}{here} and documented \href{https://archive.ics.uci.edu/ml/datasets/Wine+Quality}{here}, propose a model for wine quality. -->
<!-- \end{exerc} -->
</div>
<div id="MNL" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> General multinomial logit model<a class="anchor" aria-label="anchor" href="#MNL"><i class="fas fa-link"></i></a>
</h2>
<p>This section introduces the general multinomial logit model, which is the natural extension of the binary logit model (see Table <a href="binary-choice-models.html#tab:foo">4.1</a>). Its general formulation is as follows:
<span class="math display" id="eq:GeneralMNL">\[\begin{equation}
g_j(\mathbf{x}_i;\boldsymbol\theta) = \frac{\exp(\theta_j'\mathbf{x}_i)}{\sum_{k=1}^J \exp(\theta_k'\mathbf{x}_i)}.\tag{5.4}
\end{equation}\]</span></p>
<p>Note that, by construction, <span class="math inline">\(g_j(\mathbf{x}_i;\boldsymbol\theta) \in [0,1]\)</span> and <span class="math inline">\(\sum_{j}g_j(\mathbf{x}_i;\boldsymbol\theta)=1\)</span>.</p>
<p>The components of <span class="math inline">\(\mathbf{x}_i\)</span> (regressors, or covariates) may be <em>alternative-specific</em> or <em>alternative invariant</em> (see also Section <a href="binary-choice-models.html#Avregressors">4.2</a>). We may, e.g., organize <span class="math inline">\(\mathbf{x}_i\)</span> as follows:
<span class="math display" id="eq:xorganiz">\[\begin{equation}
\mathbf{x}_i = [\mathbf{u}_{i,1}',\dots,\mathbf{u}_{i,J}',\mathbf{v}_{i}']',\tag{5.5}
\end{equation}\]</span>
where the notations are as in Section <a href="binary-choice-models.html#Avregressors">4.2</a>, that is:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{u}_{i,j}\)</span> (<span class="math inline">\(j \in \{1,\dots,J\}\)</span>): vector of variables associated with agent <span class="math inline">\(i\)</span> and alternative <span class="math inline">\(j\)</span> (alternative-specific regressors). Examples: Travel time per type of transportation (transportation choice), wage per type of work, cost per type of car.</li>
<li>
<span class="math inline">\(\mathbf{v}_{i}\)</span>: vector of variables associated with agent <span class="math inline">\(i\)</span> but alternative-invariant. Examples: age or gender of agent <span class="math inline">\(i\)</span>,</li>
</ul>
<p>When <span class="math inline">\(\mathbf{x}_i\)</span> is as in Eq. <a href="multiple-choice-models.html#eq:xorganiz">(5.5)</a>, with obvious notations, <span class="math inline">\(\theta_j\)</span> is of the form:
<span class="math display" id="eq:thetaOrganiz">\[\begin{equation}
\theta_j = [{\theta^{(u)}_{1,j}}',\dots,{\theta^{(u)}_{J,j}}',{\theta_j^{(v)}}']',\tag{5.6}
\end{equation}\]</span>
and <span class="math inline">\(\boldsymbol\theta=[\theta_1',\dots,\theta_J']'\)</span>.</p>
<p>The literature has considered different specific cases of the general multinomial logit model:<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The labelling “CL” and “MNL” —used in the literature— are relatively &lt;em&gt;ad hoc&lt;/em&gt; (see 15.4.1 in &lt;span class="citation"&gt;Cameron and Trivedi (&lt;a href="references.html#ref-Cameron_Trivedi_2005" role="doc-biblioref"&gt;2005&lt;/a&gt;)&lt;/span&gt;).&lt;/p&gt;'><sup>14</sup></a></p>
<ul>
<li>
<strong>Conditional logit (CL)</strong> with alternative-varying regressors:
<span class="math display" id="eq:thetaOrganizCL">\[\begin{equation}
\theta_j = [\mathbf{0}',\dots,\mathbf{0}',\underbrace{\boldsymbol\beta'}_{\mbox{j$^{th}$ position}},\mathbf{0}',\dots]',\tag{5.7}
\end{equation}\]</span>
i.e., we have <span class="math inline">\(\boldsymbol\beta=\theta^{(u)}_{1,1}=\dots=\theta^{(u)}_{J,J}\)</span> and <span class="math inline">\(\theta^{(u)}_{i,j}=\mathbf{0}\)</span> for <span class="math inline">\(i \ne j\)</span>.</li>
<li>
<strong>Multinomial logit (MNL)</strong> with alternative-invariant regressors:
<span class="math display" id="eq:thetaOrganizML">\[\begin{equation}
\theta_j = \left[\mathbf{0}',\dots,\mathbf{0}',{\theta_j^{(v)}}'\right]'.\tag{5.8}
\end{equation}\]</span>
</li>
<li>
<strong>Mixed logit:</strong>
<span class="math display" id="eq:thetaOrganizCL">\[\begin{equation}
\theta_j = \left[\mathbf{0}',\dots,\mathbf{0}',\boldsymbol\beta',\mathbf{0}',\dots,\mathbf{0}',{\theta_j^{(v)}}'\right]'.\tag{5.7}
\end{equation}\]</span>
</li>
</ul>
<div class="example">
<p><span id="exm:FishingGeneralLogit" class="example"><strong>Example 5.2  (CL and MNL with the fishing-mode dataset) </strong></span>The following lines replicate Table 15.2 in <span class="citation">Cameron and Trivedi (<a href="references.html#ref-Cameron_Trivedi_2005" role="doc-biblioref">2005</a>)</span> (see also Examples <a href="binary-choice-models.html#exm:FishingTable">4.2</a> and <a href="binary-choice-models.html#exm:Fisch142">4.4</a>):</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify data organization:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=mlogit">mlogit</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stargazer</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"Fishing"</span>,package<span class="op">=</span><span class="st">"mlogit"</span><span class="op">)</span></span>
<span><span class="va">Fish</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit-deprecated.html">mlogit.data</a></span><span class="op">(</span><span class="va">Fishing</span>,</span>
<span>                    varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>,</span>
<span>                    choice <span class="op">=</span> <span class="st">"mode"</span>,</span>
<span>                    shape <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span></span>
<span><span class="va">MNL1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">mode</span> <span class="op">~</span> <span class="va">price</span> <span class="op">+</span> <span class="va">catch</span>, data <span class="op">=</span> <span class="va">Fish</span><span class="op">)</span></span>
<span><span class="va">MNL2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">mode</span> <span class="op">~</span> <span class="va">price</span> <span class="op">+</span> <span class="va">catch</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">Fish</span><span class="op">)</span></span>
<span><span class="va">MNL3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">mode</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">Fish</span><span class="op">)</span></span>
<span><span class="va">MNL4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">mode</span> <span class="op">~</span> <span class="va">price</span> <span class="op">+</span> <span class="va">catch</span> <span class="op">|</span> <span class="va">income</span>, data <span class="op">=</span> <span class="va">Fish</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html">stargazer</a></span><span class="op">(</span><span class="va">MNL1</span>,<span class="va">MNL2</span>,<span class="va">MNL3</span>,<span class="va">MNL4</span>,type<span class="op">=</span><span class="st">"text"</span>,no.space <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          omit.stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## ===============================================================
##                                 Dependent variable:            
##                     -------------------------------------------
##                                        mode                    
##                        (1)        (2)        (3)        (4)    
## ---------------------------------------------------------------
## (Intercept):boat     0.871***              0.739***   0.527**  
##                      (0.114)               (0.197)    (0.223)  
## (Intercept):charter  1.499***              1.341***   1.694*** 
##                      (0.133)               (0.195)    (0.224)  
## (Intercept):pier     0.307***              0.814***   0.778*** 
##                      (0.115)               (0.229)    (0.220)  
## price               -0.025***  -0.020***             -0.025*** 
##                      (0.002)    (0.001)               (0.002)  
## catch                0.377***   0.953***              0.358*** 
##                      (0.110)    (0.089)               (0.110)  
## income:boat                                0.0001**   0.0001*  
##                                           (0.00004)   (0.0001) 
## income:charter                             -0.00003   -0.00003 
##                                           (0.00004)   (0.0001) 
## income:pier                               -0.0001*** -0.0001** 
##                                            (0.0001)   (0.0001) 
## ---------------------------------------------------------------
## Observations          1,182      1,182      1,182      1,182   
## R2                    0.178      0.014      0.189              
## Log Likelihood      -1,230.784 -1,311.980 -1,477.151 -1,215.138
## ===============================================================
## Note:                               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<p><strong>ML estimation</strong></p>
<p>General multinomial logit models can be estimated by Maximum Likelihood techniques (see Section <a href="estimation-methods.html#secMLE">3.2</a>). Consider the general model described in Eq. <a href="multiple-choice-models.html#eq:generalMultiNom">(5.1)</a>. It can be noted that:
<span class="math display">\[
f(y_i|\mathbf{x}_i;\boldsymbol\theta) = \prod_{j=1}^J g_j(\mathbf{x}_i;\boldsymbol\theta)^{\mathbb{I}_{\{y_i=j\}}},
\]</span>
which leads to
<span class="math display">\[
\log f(y_i|\mathbf{x}_i;\boldsymbol\theta) = \sum_{j=1}^J \mathbb{I}_{\{y_i=j\}} \log \left(g_j(\mathbf{x}_i;\boldsymbol\theta)\right).
\]</span>
The log-likelihood function is therefore given by:
<span class="math display" id="eq:multipleLogLik">\[\begin{equation}
\log \mathcal{L}(\boldsymbol\theta;\mathbf{y},\mathbf{X}) = \sum_{i=1}^n  \sum_{j=1}^J \mathbb{I}_{\{y_i=j\}} \log \left(g_j(\mathbf{x}_i;\boldsymbol\theta)\right).\tag{5.3}
\end{equation}\]</span>
Numerical methods have to be employed in order to find the maximum-likelihood estimate of <span class="math inline">\(\boldsymbol\theta\)</span>. (Standard packages contain fast algorithms.)</p>
<p><strong>Marginal Effects</strong></p>
<p>Let us consider the computation of marginal effects in the general multinomial logit model (Eq. <a href="multiple-choice-models.html#eq:GeneralMNL">(5.4)</a>). Using the notation <span class="math inline">\(p_{i,j} \equiv \mathbb{P}(y_i=j|\mathbf{x}_i;\boldsymbol\theta)\)</span>, we have:
<span class="math display">\[\begin{eqnarray*}
\frac{\partial p_{i,j}}{\partial x_{i,s}} &amp;=&amp; \frac{\theta_{j,s}\exp(\theta_j'\mathbf{x}_i)\sum_{k=1}^J \exp(\theta_k'\mathbf{x}_i)}{(\sum_{k=1}^J \exp(\theta_k'\mathbf{x}_i))^2} \\
&amp;&amp; - \frac{\exp(\theta_j'\mathbf{x}_i)\sum_{k=1}^J \theta_{k,s} \exp(\theta_k'\mathbf{x}_i)}{(\sum_{k=1}^J \exp(\theta_k'\mathbf{x}_i))^2}\\
&amp;=&amp; \theta_{j,s} p_{i,j} - \sum_{k=1}^J \theta_{k,s} p_{i,j}p_{i,k}\\
&amp;=&amp;  p_{i,j} \times \Big(\theta_{j,s} - \underbrace{\sum_{k=1}^J \theta_{k,s} p_{i,k}}_{=\overline{\boldsymbol{\theta}}^{(i)}_{s}}\Big),
\end{eqnarray*}\]</span>
where <span class="math inline">\(\overline{\boldsymbol\theta}^{(i)}_{s}\)</span> does not depend on <span class="math inline">\(j\)</span>. Note that the sign of the marginal effect is not necessarily that of <span class="math inline">\(\theta_{j,s}\)</span>.</p>
<p><strong>Random Utility models</strong></p>
<p>The general multinomial logit model may arise as the natural specification arising in structural contexts where agents compare (random) utilities associated with <span class="math inline">\(J\)</span> potential outcomes (see Section <a href="binary-choice-models.html#latent">4.1</a> for the binary situation).</p>
<p>Let’s drop the <span class="math inline">\(i\)</span> subscript for simplicity and assume that the utility derived form choosing <span class="math inline">\(j\)</span> is given by <span class="math inline">\(U_j = V_j + \varepsilon_j\)</span>, where <span class="math inline">\(V_j\)</span> is deterministic (may depend on observed covariates) and <span class="math inline">\(\varepsilon_j\)</span> is stochastic. We have (with obvious notations):
<span class="math display">\[\begin{eqnarray*}
\mathbb{P}(y=j) &amp;=&amp; \mathbb{P}(U_j&gt;U_k,\,\forall k \ne j)\\
\mathbb{P}(y=j) &amp;=&amp; \mathbb{P}(U_k-U_j&lt;0,\,\forall k \ne j)\\
\mathbb{P}(y=j) &amp;=&amp; \mathbb{P}(\underbrace{\varepsilon_k-\varepsilon_j}_{=:\tilde\varepsilon_{k,j}}&lt;\underbrace{V_j - V_k}_{=:-\tilde{V}_{k,j}},\,\forall k \ne j).
\end{eqnarray*}\]</span></p>
<p>The last expression is an <span class="math inline">\((J-1)\)</span>-variate integral. While it has, in general, no analytical solution, Prop. <a href="multiple-choice-models.html#prp:Weibull">5.1</a> shows that it is the case when employing Gumbel distributions (see Def. <a href="multiple-choice-models.html#def:Gumbel">5.1</a>).</p>
<div class="definition">
<p><span id="def:Gumbel" class="definition"><strong>Definition 5.1  (Gumbel distribution) </strong></span>The c.d.f. of the Gumbel distribution (<span class="math inline">\(\mathcal{W}\)</span>) is:
<span class="math display">\[
F(u) = \exp(-\exp(-u)), \qquad f(u)=\exp(-u-\exp(u)).
\]</span></p>
</div>
<p>Remark: if <span class="math inline">\(X\sim\mathcal{W}\)</span>, then <span class="math inline">\(\mathbb{E}(X)=0.577\)</span> (Euler constant)<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;The Euler constant &lt;span class="math inline"&gt;\(\gamma\)&lt;/span&gt; satisfies &lt;span class="math inline"&gt;\(\gamma = \lim_{n\rightarrow \infty} \left(- \ln(n) + \sum_{k=1}^n \frac{1}{k}\right)\)&lt;/span&gt;.&lt;/p&gt;'><sup>15</sup></a> and <span class="math inline">\(\mathbb{V}ar(X)=\pi^2/6\)</span>.</p>
<div class="figure" style="text-align: left-aligned">
<span style="display:block;" id="fig:Gumbel"></span>
<img src="MicroEc_files/figure-html/Gumbel-1.png" alt="C.d.f. of the Gumbel distribution ($F(x)=\exp(-\exp(-x))$)." width="95%"><p class="caption">
Figure 5.1: C.d.f. of the Gumbel distribution (<span class="math inline">\(F(x)=\exp(-\exp(-x))\)</span>).
</p>
</div>
<div class="proposition">
<p><span id="prp:Weibull" class="proposition"><strong>Proposition 5.1  (Weibull) </strong></span>In the context of the utility model described above, if <span class="math inline">\(\varepsilon_j \sim \,i.i.d.\,\mathcal{W}\)</span>, then
<span class="math display">\[
\mathbb{P}(y=j) = \frac{\exp(V_j)}{\sum_{k=1}^J \exp(V_k)}.
\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-25" class="proof"><em>Proof</em>. </span>We have:
<span class="math display">\[\begin{eqnarray*}
\mathbb{P}(y=j) &amp;=&amp; \mathbb{P}(\forall\,k \ne j,\,U_k &lt; U_j) =  \mathbb{P}(\forall\,k \ne j,\,\varepsilon_k &lt; V_j - V_k + \varepsilon_j) \\
&amp;=&amp; \int \prod_{k \ne j} F(V_j - V_k + \varepsilon) f(\varepsilon)d\varepsilon.
\end{eqnarray*}\]</span>
After computation, it comes that
<span class="math display">\[
\prod_{k \ne j} F(V_j - V_k + \varepsilon) f(\varepsilon) = \exp\left[-\varepsilon-\exp(-\varepsilon+\lambda_j)\right],
\]</span>
where <span class="math inline">\(\lambda_j = \log\left(1 + \frac{\sum_{k \ne j} \exp(V_k)}{\exp(V_j)}\right)\)</span>. We then have:
<span class="math display">\[\begin{eqnarray*}
\mathbb{P}(y=j) &amp;=&amp; \int  \exp\left[-\varepsilon-\exp(-\varepsilon+\lambda_j)\right] d\varepsilon\\
&amp;=&amp; \int  \exp\left[-t - \lambda_j-\exp(-t)\right] d\varepsilon = \exp(- \lambda_j),
\end{eqnarray*}\]</span>
which leads to the result.</p>
</div>
<p>Some remarks on identification (see Def. <a href="estimation-methods.html#def:identif">3.5</a>) are in order.</p>
<ol style="list-style-type: decimal">
<li>We have:
<span class="math display">\[\begin{eqnarray*}
\mathbb{P}(y=j) &amp;=&amp; \frac{\exp(V_j)}{\sum_{k=1}^J \exp(V_k)}= \frac{\exp(V^*_j)}{1 + \sum_{k=2}^J \exp(V^*_k)},
\end{eqnarray*}\]</span>
where <span class="math inline">\(V^*_j = V_j - V_1\)</span>. We can therefore always assume that <span class="math inline">\(V_{1}=0\)</span>. In the case where <span class="math inline">\(V_{i,j} = \theta_j'\mathbf{x}_i = \boldsymbol\beta'\mathbf{u}_{i,j}+{\theta_j^{(v)}}'\mathbf{v}_i\)</span> (see Eqs. <a href="multiple-choice-models.html#eq:xorganiz">(5.5)</a> and <a href="multiple-choice-models.html#eq:thetaOrganizCL">(5.7)</a>), we can for instance assume that:
<span class="math display">\[\begin{eqnarray*}
&amp;(A)&amp; \mathbf{u}_{i,1}=0,\\
&amp;(B)&amp; \theta_1^{(v)} = 0.
\end{eqnarray*}\]</span>
If (A) does not hold, we can replace <span class="math inline">\(\mathbf{u}_{i,j}\)</span> with <span class="math inline">\(\mathbf{u}_{i,j}-\mathbf{u}_{i,1}\)</span>.</li>
<li>If <span class="math inline">\(J=2\)</span> and <span class="math inline">\(j \in \{0,1\}\)</span> (shift by one unit), we have <span class="math inline">\(\mathbb{P}(y=1|\mathbf{x})=\dfrac{\exp(\boldsymbol\theta'\mathbf{x})}{1+\exp(\boldsymbol\theta'\mathbf{x})}\)</span>, this is the logit model (Table <a href="binary-choice-models.html#tab:foo">4.1</a>).</li>
</ol>
<p><strong>Limitations of logit models</strong></p>
<p>In a Logit model, we have:
<span class="math display" id="eq:condiProba">\[\begin{equation}
\mathbb{P}(y=j|y \in \{k,j\}) = \frac{\exp(\theta_j'\mathbf{x})}{\exp(\theta_j'\mathbf{x}) + \exp(\theta_k'\mathbf{x})}.\tag{5.9}
\end{equation}\]</span>
This conditional probability does not depend on other alternatives (i.e., it does not depend on <span class="math inline">\(\theta_m\)</span>, <span class="math inline">\(m \ne j,k\)</span>). In particular, if <span class="math inline">\(\mathbf{x} = [\mathbf{u}_1',\dots,\mathbf{u}_J',\mathbf{v}']'\)</span>, then changes in <span class="math inline">\(\mathbf{u}_m\)</span> (<span class="math inline">\(m \ne j,\,k\)</span>) have no impact on the object shown in Eq. <a href="multiple-choice-models.html#eq:condiProba">(5.9)</a>.</p>
<p>That is, a Multinomial Logit can be seen as a series of pairwise comparisons that are unaffected by the characteristics of alternatives. Such a model is said to satisfy the <strong>independence from irrelevant alternatives (IIA)</strong> property. That is, in these models, for any individual, the ratio of probabilities of choosing two alternatives is independent of the availability or attributes of any other alternatives. While this may not sound alarming, there are situations where you would like it not to be the case, this is for instance the case when you want to extrapolate the results of your estimated model to a situation where there is a novel outcome that is highly susbstitutable to one of the previous ones. This can be illustrated with the famous “red-blue bus” example:</p>
<div class="example">
<p><span id="exm:redbluebus" class="example"><strong>Example 5.3  (Red-blue bus and IIA) </strong></span>Assume one has a logit model capturing the decision to travel using either a car (<span class="math inline">\(y=1\)</span>) or a (red) bus (<span class="math inline">\(y=2\)</span>). Assume you want to augment this model to allow for a third choice (<span class="math inline">\(y=3\)</span>): travel with a blue bus. If a blue bus (<span class="math inline">\(y=3\)</span>) is exactly as a red bus, except for the color, then one would expect to have:
<span class="math display">\[
\mathbb{P}(y=3|y \in \{2,3\}) = 0.5,
\]</span>
i.e. <span class="math inline">\(\theta_2 = \theta_3\)</span>.</p>
<p>Assume we had <span class="math inline">\(V_1=V_2\)</span>. We expect to have <span class="math inline">\(V_2=V_3\)</span> (hence <span class="math inline">\(p_2=p_3\)</span>). A multinomial logit model would then imply <span class="math inline">\(p_1=p_2=p_3=0.33\)</span>. It would however seem more reasonable to have <span class="math inline">\(p_1 = p_2 + p_3 = 0.5\)</span> and <span class="math inline">\(p_2=p_3=0.25\)</span>.</p>
</div>
<!-- **Sequential models** -->
<!-- Naturally, other possible ad-hoc modelling strategy are possible, e.g. sequential modelling: -->
<!-- \begin{eqnarray*} -->
<!-- \mathbb{P}(y=1|\bv{x}) &=& F(\theta_1'\bv{x}) \\ -->
<!-- \mathbb{P}(y=2|\bv{x}) &=& (1-F(\theta_1'\bv{x})) \times F(\theta_2'\bv{x}) \\ -->
<!-- \mathbb{P}(y=3|\bv{x}) &=& (1-F(\theta_1'\bv{x})) \times (1 - F(\theta_2'\bv{x})). -->
<!-- \end{eqnarray*} -->
<!-- Easily checked that $\sum_j \mathbb{P}(y=j|\bv{x})=1$. -->
<!-- Example: car purchase; 1st choice = brand, 2nd choice = color. -->
<!-- Likelihood function: -->
<!-- \begin{eqnarray*} -->
<!-- \mathcal{L}(\theta_1,\theta_2;\bv{y},\bv{X}) &=& \prod_{j \in \{1,2,3\}} \left( \prod_{i\,s.t.\,y_i=j} \mathbb{P}(y_i=j|\bv{x}_i)\right). -->
<!-- \end{eqnarray*} -->
<!-- The maximization of the log-likelihood can be performed sequentially (w.r.t. to $\theta_1$ first, and next w.r.t. $\theta_2$). -->
<!-- Weaknesses: results may depend on the chosen sequence + no clear mapping with utility framework. -->
<!-- Alternative: nested logit model (see below) where utilities of alternatives 2 and 3 are affected by correlated shocks. -->
</div>
<div id="nested-logits" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Nested logits<a class="anchor" aria-label="anchor" href="#nested-logits"><i class="fas fa-link"></i></a>
</h2>
<p>Nested Logits are natural extensions of logit models when choices feature a nesting structure. This approach is relevant when it makes sense to group some choices into the same <em>nest</em>, also called <em>limbs</em>. Intuitively, this framework is consistent with the idea according to which, for each agent, there exist unobserved nest-specific variables.</p>
<!-- %  \item Choice of selecting $j_1 \in \{1,\dots,J_1\}$ and then $j_2 \in \{1,\dots,J_2\}$ is given by: -->
<!-- %  $$ -->
<!-- %  \mathbb{P}(y_1 = j_1,y_2=j_2) = \underbrace{\mathbb{P}(y_2=j_2|y_1 = j_1)}_{\mbox{2$^{nd}$ logit}}\underbrace{\mathbb{P}(y_1 = j_1)}_{\mbox{1$^{st}$ logit}}. -->
<!-- %  $$ -->
<p>The setup is as follows: we consider <span class="math inline">\(J\)</span> <em>limbs</em>. For each limb <span class="math inline">\(j\)</span>, we have <span class="math inline">\(K_j\)</span> <em>branches</em>. Let us denotes by <span class="math inline">\(y_1\)</span> the limb choice (i.e., <span class="math inline">\(y_1 \in \{1,\dots,J\}\)</span>) and by <span class="math inline">\(y_2\)</span> the branch choice (with <span class="math inline">\(y_2 \in \{1,\dots,K_j\}\)</span>). The utility associated with the pair of choices <span class="math inline">\((j,k)\)</span> is given by
<span class="math display">\[
U_{j,k} = V_{j,k} + \varepsilon_{j,k}.
\]</span>
We have:
<span class="math display">\[
\mathbb{P}[(y_1,y_2) = (j,k)|\mathbf{x}] = \mathbb{P}(U_{j,k}&gt;U_{l,m},\,(l,m) \ne (j,k)|\mathbf{x}).
\]</span></p>
<p>One usually make the following two assumptions:</p>
<ol style="list-style-type: lower-roman">
<li><p>The deterministic part of the utility is given by <span class="math inline">\(V_{j,k} = \mathbf{u}_j'\boldsymbol\alpha + \mathbf{v}_{j,k}'\boldsymbol\beta_j\)</span>, where <span class="math inline">\(\boldsymbol\alpha\)</span> is common to all nests and the <span class="math inline">\(\boldsymbol\beta_j\)</span>’s are nest-specific.</p></li>
<li><p>The disturbances <span class="math inline">\(\boldsymbol\varepsilon\)</span> follow the Generalized Extreme Value (GEV) distribution (see Def. <a href="append.html#def:GEVdistri">8.15</a>).</p></li>
</ol>
<p>The following figure displays simulations of pairs <span class="math inline">\((\varepsilon_1,\varepsilon_2)\)</span> drawn from GEV distributions for different values of <span class="math inline">\(\rho\)</span>. The simulation approach is based on <a href="http://www.caee.utexas.edu/prof/bhat/ABSTRACTS/Supp_material.pdf">Bhat</a>. The code used to produce this chart is provided in Appendix <a href="append.html#App:GEV">8.5.1</a>.</p>
<div class="figure" style="text-align: left-aligned">
<span style="display:block;" id="fig:GEV"></span>
<img src="images/Figure_GEV.png" alt="GEV simulations." width="95%"><p class="caption">
Figure 5.2: GEV simulations.
</p>
</div>
<p>Under (i) and (ii), we have:
<span class="math display" id="eq:Nested">\[\begin{eqnarray}
\mathbb{P}[(y_1,y_2) = (j,k)|\mathbf{x}] &amp;=&amp; \underbrace{\frac{\exp(\mathbf{u}_j'\boldsymbol\alpha + \rho_j I_j)}{\sum_{m=1}^J \exp(\mathbf{u}_m'\boldsymbol\alpha + \rho_m I_m)}}_{= \mathbb{P}[y_1 = j|\mathbf{x}]} \times \nonumber\\
&amp;&amp; \underbrace{\frac{\exp(\mathbf{v}_{j,k}'\boldsymbol\beta_j/\rho_j)}{\sum_{l=1}^{K_j} \exp(\mathbf{v}_{j,l}'\boldsymbol\beta_j/\rho_j)}}_{= \mathbb{P}[y_2 = k|y_1=j,\mathbf{x}]}, \tag{5.10}
\end{eqnarray}\]</span>
where <span class="math inline">\(I_j\)</span>’s are called inclusive values (or log sums), given by:
<span class="math display">\[
I_j = \log \left( \sum_{l=1}^{K_j} \exp(\mathbf{v}_{j,l}'\boldsymbol\beta_j/\rho_j)\right).
\]</span></p>
<p>Some remarks are in order:</p>
<ol style="list-style-type: lower-alpha">
<li>It can be shown that <span class="math inline">\(\rho_j = \sqrt{1 - \mathbb{C}or(\varepsilon_{j,k},\varepsilon_{j,l})}\)</span>, for <span class="math inline">\(k \ne l\)</span>.</li>
<li>
<span class="math inline">\(\rho_j=1\)</span> implies that <span class="math inline">\(\varepsilon_{j,k}\)</span> and <span class="math inline">\(\varepsilon_{j,l}\)</span> are uncorrelated (we are then back to the multinomial logit case).</li>
<li>When <span class="math inline">\(J=1\)</span>:
<span class="math display">\[
F([\varepsilon_1,\dots,\varepsilon_K]',\rho) = \exp\left(-\left(\sum_{k=1}^{K} \exp(-\varepsilon_k/\rho)\right)^{\rho}\right).
\]</span>
</li>
<li>We have:
<span class="math display">\[\begin{eqnarray*}
I_j = \mathbb{E}(\max_k(U_{j,k})) &amp;=&amp; \mathbb{E}(\max_k(V_{j,k} + \varepsilon_{j,k})),
\end{eqnarray*}\]</span>
The inclusive values can therefore be seen as measures of the relative attractiveness of a nest.</li>
</ol>
<p>This approach allows for some level of correlation across the <span class="math inline">\(\varepsilon_{j,k}\)</span> (for a given <span class="math inline">\(j\)</span>). This can be interpreted as the existence of an (unobserved) <em>common error component</em> for the alternatives of a same nest. This component contributes to making the alternatives of a given nest more similar. In other words, this approach can accommodate a higher sensitivity (cross-elasticity) between the alternatives of a given nest.</p>
<p>Note that if the common component is reduced to zero (i.e. <span class="math inline">\(\rho_i=1\)</span>), the model boils down to the multinomial logit model with no covariance of error terms among the alternatives.</p>
<p>Contrary to the general multinmial model, nested logits can solve the Red-Blue problem described in Section <a href="multiple-choice-models.html#MNL">5.2</a> (see Example <a href="multiple-choice-models.html#exm:redbluebus">5.3</a>). Assume you have estimated a model specifying <span class="math inline">\(U_{1} = V_{1} + \varepsilon_{1}\)</span> (car choice) and <span class="math inline">\(U_{2} = V_{2} + \varepsilon_{2}\)</span> (red bus choice). You can then assume that the blue-bus utility is of the form <span class="math inline">\(U_{3} = V_{2} + \varepsilon_{3}\)</span> where <span class="math inline">\(\varepsilon_{3}\)</span> is perfectly correlated to <span class="math inline">\(\varepsilon_{2}\)</span>. This is done by redefining the set of choices as follows:
<span class="math display">\[\begin{eqnarray*}
j=1 &amp;\Leftrightarrow&amp; (j'=1,k=1) \\
j=2 &amp;\Leftrightarrow&amp; (j'=2,k=1) \\
j=3 &amp;\Leftrightarrow&amp; (j'=2,k=2),
\end{eqnarray*}\]</span>
and by setting <span class="math inline">\(\rho_2 \rightarrow 0\)</span>.</p>
<p>IIA holds within a nest, but not when considering alternatives in different nests. Indeed, using Eq. <a href="multiple-choice-models.html#eq:Nested">(5.10)</a>:
<span class="math display">\[
\frac{\mathbb{P}[y_1=j,y_2=k_A|\mathbf{x}] }{\mathbb{P}[y_1=j,y_2=k_B|\mathbf{x}]} = \frac{\exp(\mathbf{v}_{j,k_A}'\boldsymbol\beta_j/\rho_j)}{\exp(\mathbf{v}_{j,k_B}'\boldsymbol\beta_j/\rho_j)},
\]</span>
i.e. we have IIA in nest <span class="math inline">\(j\)</span>.</p>
<p>By contrast:
<span class="math display">\[\begin{eqnarray*}
\frac{\mathbb{P}[y_1=j_A,y_2=k_A|\mathbf{x}] }{\mathbb{P}[y_1=j_B,y_2=k_B|\mathbf{x}]} &amp;=&amp; \frac{\exp(\mathbf{u}_{j_A}'\boldsymbol\alpha + \rho_{j_A} I_{j_A})\exp(\mathbf{v}_{{j_A},{k_A}}'\boldsymbol\beta_{j_A}/\rho_{j_A})}{\exp(\mathbf{u}_{j_B}'\boldsymbol\alpha + \rho_{j_B} I_{j_B})\exp(\mathbf{v}_{{j_B},{k_B}}'\boldsymbol\beta_{j_B}/\rho_{j_B})}\times\\
&amp;&amp; \frac{\sum_{l=1}^{K_{j_B}} \exp(\mathbf{v}_{{j_B},l}'\boldsymbol\beta_{j_B}/\rho_{j_B})}{\sum_{l=1}^{K_{j_A}} \exp(\mathbf{v}_{{j_A},l}'\boldsymbol\beta_{J_A}/\rho_{j_A})},
\end{eqnarray*}\]</span>
which depends on the expected utilities of all alternatives in nest <span class="math inline">\(j_A\)</span> and <span class="math inline">\(j_B\)</span>. So the IIA does not hold.</p>
<div class="example">
<p><span id="exm:nestedTravel" class="example"><strong>Example 5.4  (Travel-mode dataset) </strong></span>Let us illustrate nested logits on the travel-mode dataset used, e.g., by <span class="citation">Hensher and Greene (<a href="references.html#ref-Hensher_Greene_2002" role="doc-biblioref">2002</a>)</span> (see also <span class="citation">Heiss (<a href="references.html#ref-Heiss_2002" role="doc-biblioref">2002</a>)</span>).</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://cran.r-project.org/package=mlogit">mlogit</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stargazer</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"TravelMode"</span>, package <span class="op">=</span> <span class="st">"AER"</span><span class="op">)</span></span>
<span><span class="va">Prepared.TravelMode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit-deprecated.html">mlogit.data</a></span><span class="op">(</span><span class="va">TravelMode</span>,chid.var <span class="op">=</span> <span class="st">"individual"</span>,</span>
<span>                                   alt.var <span class="op">=</span> <span class="st">"mode"</span>,choice <span class="op">=</span> <span class="st">"choice"</span>,</span>
<span>                                   shape <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span></span>
<span><span class="co"># Fit a multinomial model:</span></span>
<span><span class="va">hl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">wait</span> <span class="op">+</span> <span class="va">travel</span> <span class="op">+</span> <span class="va">vcost</span>, <span class="va">Prepared.TravelMode</span>,</span>
<span>             method <span class="op">=</span> <span class="st">"bfgs"</span>, heterosc <span class="op">=</span> <span class="cn">TRUE</span>, tol <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">## Fit a nested logit model:</span></span>
<span><span class="va">TravelMode</span><span class="op">$</span><span class="va">avincome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TravelMode</span>, <span class="va">income</span> <span class="op">*</span> <span class="op">(</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"air"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">TravelMode</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TravelMode</span>, <span class="va">travel</span> <span class="op">+</span> <span class="va">wait</span><span class="op">)</span><span class="op">/</span><span class="fl">60</span></span>
<span><span class="va">TravelMode</span><span class="op">$</span><span class="va">timeair</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TravelMode</span>, <span class="va">time</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">mode</span> <span class="op">==</span> <span class="st">"air"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">TravelMode</span><span class="op">$</span><span class="va">income</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TravelMode</span>, <span class="va">income</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co"># Hensher and Greene (2002), table 1 p.8-9 model 5</span></span>
<span><span class="va">TravelMode</span><span class="op">$</span><span class="va">incomeother</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">TravelMode</span>,</span>
<span>                               <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">mode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'air'</span>, <span class="st">'car'</span><span class="op">)</span>, <span class="va">income</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nl1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">gcost</span> <span class="op">+</span> <span class="va">wait</span> <span class="op">+</span> <span class="va">incomeother</span>, <span class="va">TravelMode</span>,</span>
<span>              shape<span class="op">=</span><span class="st">'long'</span>, <span class="co"># Indicates how the dataset is organized</span></span>
<span>              alt.var<span class="op">=</span><span class="st">'mode'</span>, <span class="co"># variable that defines the alternative choices.</span></span>
<span>              nests<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>public<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'train'</span>, <span class="st">'bus'</span><span class="op">)</span>,</span>
<span>                         car<span class="op">=</span><span class="st">'car'</span>,air<span class="op">=</span><span class="st">'air'</span><span class="op">)</span>, <span class="co"># defines the "limbs".</span></span>
<span>              un.nest.el <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">nl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mlogit/man/mlogit.html">mlogit</a></span><span class="op">(</span><span class="va">choice</span> <span class="op">~</span> <span class="va">gcost</span> <span class="op">+</span> <span class="va">wait</span> <span class="op">+</span> <span class="va">time</span>, <span class="va">TravelMode</span>,</span>
<span>              shape<span class="op">=</span><span class="st">'long'</span>, <span class="co"># Inidcates how the dataset is organized</span></span>
<span>              alt.var<span class="op">=</span><span class="st">'mode'</span>, <span class="co"># variable that defines the alternative choices.</span></span>
<span>              nests<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>public<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'train'</span>, <span class="st">'bus'</span><span class="op">)</span>,</span>
<span>                         car<span class="op">=</span><span class="st">'car'</span>,air<span class="op">=</span><span class="st">'air'</span><span class="op">)</span>, <span class="co"># defines the "limbs".</span></span>
<span>              un.nest.el <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/stargazer/man/stargazer.html">stargazer</a></span><span class="op">(</span><span class="va">nl1</span>,<span class="va">nl2</span>,type<span class="op">=</span><span class="st">"text"</span>,no.space <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
## ==============================================
##                       Dependent variable:     
##                   ----------------------------
##                              choice           
##                        (1)            (2)     
## ----------------------------------------------
## (Intercept):train     -0.211        -0.284    
##                      (0.562)        (0.551)   
## (Intercept):bus       -0.824        -0.712    
##                      (0.708)        (0.690)   
## (Intercept):car     -5.237***      -3.845***  
##                      (0.785)        (0.844)   
## gcost               -0.013***       -0.004    
##                      (0.004)        (0.006)   
## wait                -0.088***      -0.089***  
##                      (0.011)        (0.011)   
## incomeother          0.430***                 
##                      (0.113)                  
## time                               -0.202***  
##                                     (0.060)   
## iv                   0.835***      0.877***   
##                      (0.192)        (0.198)   
## ----------------------------------------------
## Observations           210            210     
## R2                    0.328          0.313    
## Log Likelihood       -190.779      -194.841   
## LR Test (df = 7)    185.959***    177.836***  
## ==============================================
## Note:              *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="binary-choice-models.html"><span class="header-section-number">4</span> Binary-choice models</a></div>
<div class="next"><a href="tobit-and-sample-selection-models.html"><span class="header-section-number">6</span> Tobit and sample-selection models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#multiple-choice-models"><span class="header-section-number">5</span> Multiple Choice Models</a></li>
<li><a class="nav-link" href="#ordered-case"><span class="header-section-number">5.1</span> Ordered case</a></li>
<li><a class="nav-link" href="#MNL"><span class="header-section-number">5.2</span> General multinomial logit model</a></li>
<li><a class="nav-link" href="#nested-logits"><span class="header-section-number">5.3</span> Nested logits</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Micro-Econometrics</strong>" was written by Jean-Paul Renne. It was last built on 2023-01-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
